import { ApiMeta, Stability } from '../../../components/ApiMeta';

# builtin:swc-loader

<ApiMeta addedVersion="0.3.0" stability={Stability.Experimental} />

`builtin:swc-loader` 是 [`swc-loader`](https://github.com/swc-project/pkgs/tree/main/packages/swc-loader) 的 Rust 版本，旨在提供更优的性能，
Loader 的[配置](https://swc.rs/docs/configuration/compilation)与 JS 版本的 `swc-loader` 保持对齐（SWC 插件将会在未来版本进行提供，暂不支持）。

如需要在项目中使用 `builtin:swc-loader`，需进行如下配置。

如对 `ts` 文件进行转译：

```js
module.exports = {
  module: {
    rules: [
      {
        test: /\.ts$/,
        exclude: [/node_modules/],
        loader: 'builtin:swc-loader',
        options: {
          sourceMap: true,
          jsc: {
            parser: {
              syntax: 'typescript',
            },
          },
        },
        type: 'javascript/auto',
      },
    ],
  },
};
```

或是对 `jsx` 文件进行转译：

```js
module.exports = {
  module: {
    rules: [
      {
        test: /\.jsx$/,
        use: {
          loader: 'builtin:swc-loader',
          options: {
            sourceMap: true,
            jsc: {
              parser: {
                syntax: 'ecmascript',
                jsx: true,
              },
              transform: {
                react: {
                  pragma: 'React.createElement',
                  pragmaFrag: 'React.Fragment',
                  throwIfNamespace: true,
                  development: false,
                  useBuiltins: false,
                },
              },
            },
          },
        },
        type: 'javascript/auto',
      },
    ],
  },
};
```

另外，你也可以直接参考 [`example-builtin-swc-loader`](https://github.com/web-infra-dev/rspack/tree/main/examples/builtin-swc-loader) 查看更多使用指南。

#### options

参考 [SWC 配置](https://swc.rs/docs/configuration/swcrc)。

##### options.rspackExperiments

<ApiMeta stability={Stability.Experimental} addedVersion="0.3.3" />

这个字段是部分 `builtins` 替代，在保留了原有功能的基础上提供了模块粒度的精细转译。

如果是 react 应用，可以参考 [`options.jsc.transform.react`](https://swc.rs/docs/configuration/compilation#jsctransformreact) 进行配置。

- **Type:**

```ts
export type RspackExperiments = {
  import?: PluginImportOptions;
  emotion?: EmotionOptions;
  relay?: RelayOptions;
  styledComponents?: StyledComponentsOptions;
};
```

- **Default:** `{}`

其中部分配置项可以在 [builtins](/config/builtins) 下找到：

<ApiMeta stability={Stability.Experimental} addedVersion="0.3.3" />

- [import](/config/builtins#builtinspluginimport)
- [emotion](/config/builtins#builtinsemotion)
- [relay](/config/builtins#builtinsrelay)

此外一些新的特性将仅通过 `builtin:swc-loader` 提供。

##### options.rspackExperiments.styledComponents

<ApiMeta stability={Stability.Experimental} addedVersion="0.3.7" />

- **Type:**

```ts
type StyledComponentsOptions = {
  displayName?: boolean;
  ssr?: boolean;
  fileName?: boolean;
  meaninglessFileNames?: string[];
  namespace?: string;
  topLevelImportPaths?: string[];
  transpileTemplateLiterals?: boolean;
  minify?: boolean;
  pure?: boolean;
  cssProps?: boolean;
};
```

- **Default:** `{}`

配置对 [styled-components](https://github.com/styled-components/styled-components) 的编译时支持。SWC 对于 styled-components 的支持基本对齐了官方的 babel 插件，所以你可以访问 https://styled-components.com/docs/tooling#babel-plugin 了解更多信息。

通常你还需要启用 `builtin:swc-loader` 的 JSX 支持用来处理 React 组件，配置项内容可以参考：

```js
/** @type {import('@rspack/core').Configuration}*/
module.exports = {
  module: {
    rules: [
      {
        test: /\.jsx?$/,
        loader: 'builtin:swc-loader',
        options: {
          jsc: {
            parser: {
              syntax: 'ecmascript',
              jsx: true,
            },
          },
          rspackExperiments: {
            styledComponents: {
              displayName: true,
              ssr: true,
              fileName: true,
              meaninglessFileNames: ['index', 'styles'],
              namespace: 'rspack-test',
              topLevelImportPaths: [
                '@xstyled/styled-components',
                '@xstyled/styled-components/*',
              ],
              transpileTemplateLiterals: true,
              minify: true,
              pure: true,
              cssProps: true,
            },
          },
        },
      },
    ],
  },
};
```
