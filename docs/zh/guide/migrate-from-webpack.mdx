# 从 Webpack 迁移

虽然 Rspack 尽可能地兼容了 webpack 的常用 API，但是不可避免地存在一些不同，或是相同的功能在 Rspack 中有更高性能的实现方式。

> 对比 webpack 5.

> 🟩 : 支持
>
> 🟥 : 不支持
>
> 🟧 : 部分支持

## Entry

- string 🟩
- string[] 🟩
- EntryObject 🟧

  - `import: EntryItem` 🟩
  - `runtime?: string | false` 🟩
  - ...others 🟥

- Function 🟥

## Context 🟩

## Mode 🟩

## Output

Others

### Output.assetModuleFilename 🟧

- string 🟩
- function 🟥

### Output.filename 🟧

- string 🟩
- function 🟥

### Output.chunkFilename 🟧

- string 🟩
- function 🟥

### Output.cssFilename 🟧

- string 🟩
- function 🟥

### Output.cssChunkFilename 🟧

- string 🟩
- function 🟥

### Output.path 🟩

- string

### Output.publicPath 🟧

- string 🟩
- function 🟥

### Output.strictModuleErrorHandling 🟩

- boolean

### Output.[...others] 🟥

### Template strings 🟧

#### Compilation-level 🟧

- [fullhash] 🟩
- [hash] 🟥

#### Chunk-level 🟩

- [id] 🟩
- [name] 🟩
- [chunkhash] 🟩
- [contenthash] 🟩

#### Module-level 🟧

- [id] 🟩
- [moduleid] 🟥
- [hash] 🟩
- [modulehash] 🟥
- [contenthash] 🟩

#### File-level 🟧

- [file] 🟥
- [query] 🟩
- [fragment] 🟥
- [base] 🟥
- [filebase] 🟥
- [path] 🟩
- [name] 🟩
- [ext] 🟩

#### URL-level 🟥

- [url] 🟥

## Module

### Module.generator 🟥

### Module.parser 🟧

### Rule

#### Rule Condition 🟧

- string 🟩
- RegExp 🟩
- function 🟥

#### Rule.exclude 🟩

#### Rule.include 🟩

#### Rule.loaders 🟩

推荐使用 `Rule.use`。

#### Rule.parse 🟩

- dataUrlCondition 🟩

#### Rule.generator 🟧

- filename 🟩
- dataUrl 🟥
- emit 🟥
- publicPath 🟥
- outputPath 🟥

#### Rule.resource 🟩

#### Rule.resourceQuery 🟩

#### Rule.sideEffects 🟩

#### Rule.test 🟩

#### Rule.type 🟧

- asset/resource 🟩
- asset/inline 🟩
- asset/source 🟩
- asset 🟩

Other types supported by Rspack:

- javascript/auto
- typescript
- css
- css/module
- json

#### Rule.use 🟧

- useEntry 🟩
- function 🟥

#### Rule.resolve 🟧

#### Rule.[...others] 🟥

## Resolve

### Resolve.alias 🟩

### Resolve.aliasField 🟧

类型差异:

- webpack: `string[]`
- Rspack: `Boolean`

### Resolve.conditionNames 🟩

### Resolve.extensions 🟧

默认值不同:

- webpack: `['.js', '.json', '.wasm']`
- rspack: `['.tsx', '.jsx', '.ts', '.js', '.json', '.d.ts']`

### Resolve.fallback 🟩

### Resolve.mainFields 🟩

### Resolve.mainFiles 🟩

### Resolve.modules 🟩

### Resolve.preferRelative 🟩

### Resolve.[...others] 🟥

## Optimization

### Optimization.moduleIds 🟧

- natural 🟥
- named 🟩
- deterministic 🟩
- size 🟥

### Optimization.minimize 🟩

### Optimization.minimizer 🟧 ???

- plugins[] 🟩
- function 🟥

### Optimization.removeAvailableModules 🟧

默认值不同:

- webpack: 仅 production 模式下为 `true`
- rspack: 默认都为 `true`

### Optimization.removeEmptyChunks 🟩

### Optimization.runtimeChunk 🟧

- object 🟥
- string 🟥
- boolean 🟩

### Optimization.sideEffects 🟩

### Optimization.splitChunks 🟧

_默认值完全相同。_

#### splitChunks.automaticNameDelimiter 🟩

#### splitChunks.chunks 🟩

#### splitChunks.maxAsyncRequests 🟩

#### splitChunks.maxInitialRequests 🟩

#### splitChunks.defaultSizeTypes 🟩

#### splitChunks.minChunks 🟩

#### splitChunks.hidePathInfo

#### splitChunks.minSize 🟧

- number 🟩
- object 🟥

#### splitChunks.minSizeReduction 🟧

- number 🟩
- object 🟥

#### splitChunks.enforceSizeThreshold 🟩

#### splitChunks.minRemainingSize 🟩

#### splitChunks.layer 🟥

#### splitChunks.maxSize 🟩

#### splitChunks.maxAsyncSize 🟩

#### splitChunks.maxInitialSize 🟩

#### splitChunks.name 🟩

#### splitChunks.usedExports 🟥

#### splitChunks.cacheGroups 🟧

## Plugins

一些插件可以被内置功能取代: [plugin-compat](/guide/plugin-compat).

支持的插件 api : [plugin-api](/api/plugin-api)

### DefinePlugin 🟩

使用 `builtins.define`

### html-webpack-plugin 🟩

Rspack 内置了对 html 的支持，这意味着你可以使用 `builtins.html` 来代替 html-webpack-plugin。

```diff
 const HtmlWebpackPlugin = require("html-webpack-plugin");

 module.exports = {
+  builtins: {
+    html: [
+      {
+        template: "index.html",
+        filename: "index.html",
+      },
+    ],
+  },
-  plugins: [
-    new HtmlWebpackPlugin({
-      template: "index.html",
-      filename: "index.html",
-    }),
-  ],
 };
```

## Loaders

### 移除 babel-loader

Rspack 已经内置了对 TypeScript、JSX 以及最新的 JavaScript 语法的支持，这意味着如果你的 babel-loader 只是为了支持 TypeScript、JSX 以及更新的 JavaScript 语法，那么完全可以移除 babel-loader。

如果你的 babel-loader 是为了支持自定义的转换逻辑，那么这部分的 babel-loader 可以保留，但是我们不鼓励用户对大量的文件使用 babel-loader，因为这会导致严重的性能恶化。

```diff
 module.exports = {
   module: {
-    rules: [
-      {
-        test: /\.tsx?$/i,
-        use: [
-          {
-            loader: 'babel-loader',
-            options: {
-              presets: ['@babel/preset-typescript'],
-            },
-          },
-        ],
-        test: /\.jsx?$/i,
-        use: [
-          {
-            loader: 'babel-loader',
-            options: {
-              presets: ['@babel/preset-react'],
-            },
-          },
-        ],
-      },
-    ],
   },
 };
```

同时，Rspack 还默认支持了 JavaScript 语法降级的功能，这意味着你不需要再使用 babel-loader 来处理浏览器兼容性，你可以通过 [target](/config/target) 和 [builtins.presetEnv](/config/builtins#builtinspresetenv) 来指定浏览器兼容范围。

```diff
 module.exports = {
+  builtins: {
+    presetEnv: {
+      targets: ['es5'],
+    },
+  },
+  target: ['web', 'es5'],
   module: {
     rules: [
-      {
-        test: /\.jsx?$/i,
-        use: [
-          {
-            loader: 'babel-loader',
-            options: {
-              presets: ['@babel/preset-env'],
-            },
-          },
-        ],
-      },
     ],
   },
 };
```

### 移除 css-loader 和 style-loader 和 mini-css-extract-plugin

Rspack 内置支持了 css 模块类型 ，原生 css 模块类型内置了对 css、css hmr、css module 以及 css 提取功能的支持，这意味着你不需要再为 css 文件单独配置 css-loader、style-loader 和 mini-css-extract-plugin。

```diff
-const MiniCssExtractPlugin = require("mini-css-extract-plugin");

 module.exports = {
   module: {
     rules: [
-      {
-        test: /\.css$/i,
-        use: [
-          isDev ? "style-loader" : MiniCssExtractPlugin.loader,
-          "css-loader",
-        ],
-      },
+      {
+        test: /\.css$/i,
+        type: "css", // this is enabled by default for .css, so you don't need to specify it
+      },
     ],
   },
   plugins: [],
 };
```

对于 [css-modules](https://github.com/css-modules/css-modules) 的功能，通过指明 css/module 作为模块类型即可开启。

```diff
 module.exports = {
   module: {
     rules: [
+      {
+        test: /\.module\.css$/i,
+        type: "css/module", // this is enabled by default for module.css,   so you don't need to specify it
+      },
     ],
   },
 };
```

### 使用 Asset Modules 来代替 file-loader、url-loader 和 raw-loader

Rspack 对齐 webpack 5 的 Asset Modules，这意味着你可以使用 Asset Modules 来代替 file-loader 和 url-loader。

```diff
 module.exports = {
   module: {
     rules: [
+      {
+        test: /\.(png|jpe?g|gif)$/i,
+        type: "asset/resource",
+      },
+      {
+        test: /^BUILD_ID$/,
+        type: "asset/source",
+      },
-      {
-        test: /\.(png|jpe?g|gif)$/i,
-        use: ["file-loader"],
-      },
-      {
-        test: /^BUILD_ID$/,
-        use: ["raw-loader",],
-      },
     ],
   },
 };
```

## DevServer 🟧

// todo

## Cache 🟥

rspack 只支持设置为布尔值。

## Devtool 🟩

## Target 🟧

- async-node[[X].Y] 🟥
- electron[[X].Y]-main 🟥
- electron[[X].Y]-renderer 🟥
- electron[[X].Y]-preload 🟥
- node[[X].Y] 🟧
  - `node`
- node-webkit[[X].Y] 🟥
- nwjs[[X].Y] 🟥
- web 🟩
- webworker 🟧
  - 改为 `web-worker`
- esX 🟩
- browserslist 🟩

## Watch and WatchOptions 🟧

### Watch 🟩

### WatchOptions.aggregateTimeout 🟥

### WatchOptions.ignored 🟩

### WatchOptions.poll 🟩

### WatchOptions.followSymlinks 🟥

### WatchOptions.stdin 🟥

## Externals 🟧

- string 🟩
- object 🟩
- function 🟥
- RegExp 🟥
- [] 🟥

### ExternalsType 🟧

- commonjs 🟩
- global 🟩
- module 🟩
- promise 🟥
- self 🟩
- script 🟥
- this 🟩
- var 🟩
- window 🟩

rspack 额外支持的属性:

- amd
- amd-require
- import
- jsonp
- node-commonjs
- system
- umd
- umd2

## Performance 🟥

## Node 🟧

### Node.global 🟩

### Node.\_\_dirname 🟩

### Node.\_\_filename 🟥

## Stats 🟧

// todo

## Experiments 🟥

虽然都有 `experiments` 配置项，但两者的实验功能完全不同，所以不要在 rspack 中配置 webpack 的实验功能。
