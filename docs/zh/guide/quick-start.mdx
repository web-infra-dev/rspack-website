# å¿«é€Ÿä¸Šæ‰‹

é€šè¿‡æœ¬ç« èŠ‚æ¥äº†è§£å¦‚ä½•å¿«é€Ÿä¸Šæ‰‹å¹¶ä½¿ç”¨ Rspackã€‚

## ä½¿ç”¨è„šæ‰‹æ¶å¿«é€Ÿåˆ›å»º

### ä½¿ç”¨ Rspack CLI

ä½ å¯ä»¥ç›´æ¥ä½¿ç”¨ Rspack CLI æ¥åˆ›å»ºä¸€ä¸ªåŸºç¡€é¡¹ç›®ï¼Œè°ƒç”¨ä»¥ä¸‹å‘½ä»¤å³å¯ï¼š

<Tabs values={[{ label: 'npm' }, { label: 'yarn' }, { label: 'pnpm' }, {label: 'bun'}]}>
  <Tab>

```sh
npm create rspack@latest
```

  </Tab>

  <Tab>

```sh
yarn create rspack
```

  </Tab>

  <Tab>

```sh
pnpm create rspack@latest
```

  </Tab>
    <Tab>

```sh
bun create rspack@latest
```

  </Tab>
</Tabs>

ç„¶åæŒ‰ç…§æç¤ºæ“ä½œå³å¯ã€‚

## ç¤¾åŒºå·¥å…·é“¾

ç¤¾åŒºä¸­å·²ç»æœ‰ä¸€äº›åŸºäº Rspack çš„å·¥å…·é“¾ï¼š

- å¦‚æœä½ éœ€è¦ä¸€ä¸ª React æ¡†æ¶æ¥æ„å»º Web åº”ç”¨ï¼Œä½ å¯ä»¥å°è¯• [Modern.js Framework](https://modernjs.dev/)ã€‚
- å¦‚æœä½ éœ€è¦å¼€å‘ä¸€ä¸ªé™æ€ç«™ç‚¹(å¦‚æ–‡æ¡£ç«™)ï¼Œä½ å¯ä»¥å°è¯• [Rspress](https://rspress.dev).
- å¦‚æœä½ éœ€è¦åœ¨ Monorepo é¡¹ç›®ä¸­ä½¿ç”¨ Rspackï¼Œå¹¶ä½¿ç”¨å¿«é€Ÿã€å¯æ‰©å±•çš„æ„å»ºç³»ç»Ÿï¼Œä½ å¯ä»¥å°è¯• [Nx](https://nx.dev)ã€‚

### Modern.js

[Modern.js](https://modernjs.dev/) æ˜¯å­—èŠ‚è·³åŠ¨ Web å·¥ç¨‹ä½“ç³»çš„å¼€æºç‰ˆæœ¬ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªåŸºäº Rspack å®ç°çš„æ¸è¿›å¼ React æ¡†æ¶ï¼Œå¹¶ä¸ºå¼€å‘ Web åº”ç”¨æä¾›äº†å®Œæ•´çš„è§£å†³æ–¹æ¡ˆã€‚æ¡†æ¶æ”¯æŒåµŒå¥—è·¯ç”±ã€æœåŠ¡å™¨ç«¯æ¸²æŸ“ï¼ˆSSRï¼‰ï¼Œå¹¶æä¾›å¼€ç®±å³ç”¨çš„ CSS è§£å†³æ–¹æ¡ˆï¼Œæ¯”å¦‚ styled-components å’Œ Tailwind CSSã€‚

è¯·é˜…è¯» [å®˜æ–¹æ–‡æ¡£](https://modernjs.dev/guides/get-started/introduction) æ¥äº†è§£æ›´å¤šå…³äº Modern.js çš„ä¿¡æ¯ã€‚

### Rspress

Rspress æ˜¯ä¸€ä¸ªåŸºäº Rspack çš„é™æ€ç«™ç‚¹ç”Ÿæˆå™¨ï¼Œå®ƒåŒ…å«å¦‚ä¸‹çš„ç‰¹æ€§ï¼š

- ğŸš€ å¿«é€Ÿæ„å»ºï¼šåŸºäº Rust æ„å»ºå·¥å…·å’Œ Markdown/MDX ç¼–è¯‘å™¨ï¼Œæ„å»ºé€Ÿåº¦æå¿«ï¼Œä¸ºä½ å¸¦æ¥æ›´èˆ’é€‚çš„å¼€å‘ä½“éªŒã€‚
- ğŸ“š MDX æ”¯æŒï¼šMDX æ˜¯ä¸€ç§å¼ºå¤§çš„å†…å®¹ç¼–å†™æ–¹å¼ï¼Œå…è®¸ä½ åœ¨ Markdown ä¸­ä½¿ç”¨ React ç»„ä»¶ã€‚
- ğŸ“¦ å†…ç½®å…¨æ–‡æœç´¢ï¼šåœ¨æ„å»ºè¿‡ç¨‹ä¸­è‡ªåŠ¨ç”Ÿæˆå…¨æ–‡æœç´¢ç´¢å¼•ï¼Œæä¾›å¼€ç®±å³ç”¨çš„å…¨æ–‡æœç´¢èƒ½åŠ›ã€‚
- ğŸŒˆ é™æ€ç«™ç‚¹ç”Ÿæˆï¼šåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå®ƒä¼šè‡ªåŠ¨æ„å»ºæˆé™æ€ HTML æ–‡ä»¶ï¼Œå¯ä»¥è½»æ¾éƒ¨ç½²åˆ°ä»»ä½•åœ°æ–¹ã€‚
- ğŸ”Œ æä¾›æ’ä»¶ç³»ç»Ÿï¼šæä¾›ä¸€ä¸ªæ’ä»¶ç³»ç»Ÿï¼Œä½ å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€è¦å®šåˆ¶æ„å»ºè¿‡ç¨‹å’Œè‡ªå®šä¹‰ä¸»é¢˜ã€‚

ä½ å¯ä»¥å» [å®˜ç½‘](https://rspress.dev) äº†è§£æ›´å¤šå…³äº Rspress çš„ä¿¡æ¯ã€‚

### ä½¿ç”¨ Nx

Nx æ˜¯ä¸€ä¸ªå¿«é€Ÿã€å¯æ‰©å±•çš„æ„å»ºç³»ç»Ÿï¼ŒRspack å›¢é˜Ÿä¸ Nx å›¢é˜Ÿåˆä½œæä¾›äº† [Rspack Nx æ’ä»¶](https://www.npmjs.com/package/@nx/rspack)ã€‚è¯¥æ’ä»¶ä¼šç»™ä½ ä¸€ä¸ªé¢„è®¾é¡¹ç›®ï¼Œå°† Rspack ä¸ Reactã€TypeScriptã€ESLintã€Jest å’Œç”¨äº e2e æµ‹è¯•çš„ Cypress æ•´åˆåœ¨ä¸€èµ·ï¼Œä½¿ä½ èƒ½è¿…é€Ÿæ­å»ºä¸€ä¸ªç”¨äºç”Ÿäº§ç¯å¢ƒçš„åº”ç”¨ã€‚

è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œç”¨ React å’Œ Rspack å»ºç«‹ä¸€ä¸ªæ–°çš„ Nx workspaceã€‚

<Tabs values={[{ label: 'npm' }, { label: 'yarn' }, { label: 'pnpm' }]}>
  <Tab>

```sh
npx create-nx-workspace myrspackapp --preset=@nx/rspack
```

  </Tab>

  <Tab>

```sh
yarn create nx-workspace myrspackapp --preset=@nx/rspack --pm=yarn
```

  </Tab>

  <Tab>

```sh
pnpm create nx-workspace myrspackapp --preset=@nx/rspack  --pm=pnpm
```

  </Tab>
</Tabs>

è¿™ä¸ªé¢„è®¾é¡¹ç›®å·²ç»åŒ…å«äº† Rspackã€TypeScriptã€TSX å’Œ Reactã€‚æ­¤å¤–ï¼Œå®ƒè¿˜é…å¤‡äº†ç”¨äºæµ‹è¯•çš„ Jest å’Œ Cypress ã€ç”¨äºä»£ç è§„èŒƒæ ¡éªŒçš„ ESLintã€‚

åˆ›å»ºæˆåŠŸåï¼Œä½ å¯ä»¥ç›´æ¥ç”¨ `npm start` æ¥å¯åŠ¨å¼€å‘æœåŠ¡å™¨ã€‚ä½ ä¹Ÿå¯ä»¥è¿è¡Œ `npm run build` æ¥ä¸ºç”Ÿäº§ç¯å¢ƒæ„å»ºåº”ç”¨ç¨‹åºã€è¿è¡Œ `npm run test` æ¥è¿è¡Œå•å…ƒæµ‹è¯•ã€‚

ä½ å¯ä»¥åœ¨ [https://nx.dev](https://nx.dev) äº†è§£æ›´å¤šå…³äº Nx çš„ä¿¡æ¯ã€‚

## æ‰‹åŠ¨å®‰è£…æŒ‡å—

### å®‰è£…

é¦–å…ˆæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç›®å½•ï¼Œåˆå§‹åŒ– npm ï¼Œç„¶ååœ¨æœ¬åœ°å®‰è£… @rspack/cliï¼Œé€šè¿‡å¦‚ä¸‹æ–¹å¼è¿›è¡Œå®‰è£…:

import { Tabs, Tab } from '@theme';

<Tabs values={[{ label: 'npm' }, { label: 'yarn' }, { label: 'pnpm' }]}>
  <Tab>

```sh
mkdir rspack-demo
cd rspack-demo
npm init -y
npm install -D @rspack/cli
```

  </Tab>

  <Tab>

```sh
mkdir rspack-demo
cd rspack-demo
npm init -y
yarn add -D @rspack/cli
```

  </Tab>

  <Tab>

```sh
mkdir rspack-demo
cd rspack-demo
npm init -y
pnpm install -D @rspack/cli
```

  </Tab>
</Tabs>

## åˆ›å»ºç¬¬ä¸€ä¸ª bundle

### é¡¹ç›®åˆ›å»º

é¦–å…ˆåˆ›å»ºä¸€ä¸ªå…¥å£æ–‡ä»¶ `src/index.js` å’Œ ä¸€ä¸ª `src/answer.js`

```js title="src/index.js"
import { answer } from './answer';
function render() {
  document.getElementById(
    'root'
  ).innerHTML = `the answer to the universe is ${answer}`;
}
render();
```

```js title="src/answer.js"
export const answer = 42;
```

### ä½¿ç”¨é…ç½®æ–‡ä»¶

Rspack é»˜è®¤é€šè¿‡ `rspack.config.js` æ¥é…ç½®æ‰“åŒ…è¡Œä¸ºï¼Œæˆ‘ä»¬å¯ä»¥åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª `rspack.config.js` æ–‡ä»¶ï¼Œç„¶ååœ¨é‡Œé¢é…ç½®æ‰“åŒ…è¡Œä¸ºï¼Œå¦‚ä¸‹:

```js title="rspack.config.js"
const path = require('path');

module.exports = {
  entry: {
    main: './src/index.js',
  },
  output: {
    filename: 'main.js',
    path: path.resolve(__dirname, 'dist'),
  },
};
```

æˆ‘ä»¬é€šè¿‡ `npx rspack build` æ‰§è¡Œæ„å»ºï¼Œä½ ä¹Ÿå¯ä»¥é€šè¿‡ `npx rspack build -c <your-config-file>` æ¥è‡ªå®šä¹‰é…ç½®æ–‡ä»¶åã€‚build çš„è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š

```sh
npx rspack build
Time: 21.388ms
```

:::info
`@rspack/cli` é»˜è®¤çš„ stats åªè¾“å‡º errorsã€warnings å’Œ timings çš„ä¿¡æ¯ï¼Œå¯ä»¥é€šè¿‡ [`stats`](/config/stats) è®¾ç½®è¾“å‡ºæ›´å¤šæ„å»ºä¿¡æ¯ã€‚
:::

æ­¤æ—¶æˆ‘ä»¬åœ¨ `dist` ç›®å½•é‡Œç”Ÿæˆäº† `main.js` å’Œ `main.js.map` ä¸¤ä¸ªæ–‡ä»¶ï¼Œ æˆ‘ä»¬åœ¨ `dist` é‡Œåˆ›å»ºå¦‚ä¸‹çš„ `dist/index.html` æ¥éªŒè¯ç”Ÿæˆçš„äº§ç‰©è¿è¡Œæ˜¯å¦æ­£å¸¸ã€‚

```html title="dist/index.html"
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>hello rspack</title>
  </head>
  <body>
    <div id="root"></div>
    <script src="./main.js"></script>
  </body>
</html>
```

åœ¨æµè§ˆå™¨é‡Œæ‰“å¼€ `dist/index.html`ï¼Œæˆ‘ä»¬å‘ç°æµè§ˆå™¨é‡Œæ­£å¸¸æ¸²æŸ“äº† `the answer to the universe is 42`ã€‚

### æ·»åŠ ä¸‰æ–¹ä¾èµ–

Rspack ä¸ä»…å¯ä»¥æ‰“åŒ…æœ¬åœ°ä¾èµ–ï¼Œä¹Ÿå¯ä»¥æ‰“åŒ…ä¸‰æ–¹ä¾èµ–ï¼Œæˆ‘ä»¬ç°åœ¨ç”¨ React æ¥é‡æ„æˆ‘ä»¬çš„åº”ç”¨ï¼Œé¦–å…ˆæ·»åŠ  `react` ä½œä¸ºä¾èµ–ï¼š

```sh
npm install --save react@18 react-dom@18
```

å°† `src/index.js` é‡å‘½åä¸º `src/index.jsx` å¹¶ä½¿ç”¨ `React` é‡æ„ä»£ç ï¼š

```jsx title="src/index.jsx"
import { answer } from './answer';
import React from 'react';
import ReactDOM from 'react-dom/client';
const App = () => {
  return <div>the answer to the universe is {answer}</div>;
};
const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(<App />);
```

Rspack å†…ç½®äº†å¯¹ React çš„æ”¯æŒï¼Œä½ æ— éœ€ä»»ä½•é…ç½®ï¼Œä½†æ˜¯åˆ«å¿˜äº†å°† `rspack.config.js` é‡Œçš„å…¥å£æ”¹ä¸º `src/index.jsx`ã€‚

```js title="rspack.config.js"
const path = require('path');

module.exports = {
  entry: {
    main: './src/index.jsx',
  },
  output: {
    filename: 'main.js',
    path: path.resolve(__dirname, 'dist'),
  },
};
```

### æ·»åŠ  html æ”¯æŒ

Rspack å†…ç½®äº†å¯¹ html çš„æ”¯æŒï¼Œæ— éœ€è‡ªå·±æ‰‹åŠ¨çš„åœ¨ html é‡Œé…ç½®äº§ç‰© js çš„åœ°å€ï¼Œé€šè¿‡å¦‚ä¸‹æ–¹å¼ä½¿ç”¨ html åŠŸèƒ½ï¼š

```js title="rspack.config.js"
module.exports = {
  entry: {
    main: './src/index.jsx',
  },
  builtins: {
    html: [{ template: './src/index.html' }],
  },
};
```

```html title="src/index.html"
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>hello rspack</title>
  </head>
  <body>
    <div id="root"></div>
  </body>
</html>
```

æ­¤æ—¶æˆ‘ä»¬æ‰§è¡Œ `npx rspack build`ï¼Œæˆ‘ä»¬å‘ç° `dist/index.html` é‡Œè‡ªåŠ¨å¸¦ä¸Šäº† js çš„åœ°å€ï¼š

```html title="dist/index.html"
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <div id="root"></div>
    <script src="/main.js" defer></script>
  </body>
</html>
```

### ä½“éªŒ HMR

Rspack å†…ç½®äº†å¯¹ HMR çš„æ”¯æŒï¼Œå¹¶å¯¹ React é¡¹ç›®å†…ç½®äº† fast-refresh çš„æ”¯æŒï¼Œä½ æ— éœ€é…ç½®ï¼Œé€šè¿‡ `npx rspack serve` å³å¯ä½“éªŒ React çš„ HMRï¼Œ
æˆ‘ä»¬ä¿®æ”¹ `src/answer.js`

```js title="src/answer.js"
export const answer = 'Rspack';
```

æˆ‘ä»¬å‘ç°æµè§ˆå™¨ä¸Šçš„å†…å®¹è‡ªåŠ¨æ›´æ–°ä¸º `the answer to the universe is Rspack`ã€‚
