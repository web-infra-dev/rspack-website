# Builtins 内置功能

用于设置 Rspack 提供的内置功能。

- **类型：** `Record<string, any>`
- **默认值：** `{}`

:::warning 稳定性警告

_Builtins_ 提供的内置功能在未来可能会发生变化，或被更好的方式取代，请在升级时注意 builtins 的变化，我们会在 [Release Notes](https://github.com/modern-js-dev/rspack/releases) 中着重标注。

:::

## builtins.emotion

用于设置对 emotion 的编译优化。

- **类型：**

```ts
export type EmotionConfig = 
  | boolean
  | {
    sourceMap?: boolean;
    autoLabel?: "never" | "dev-only" | "always";
    labelFormat?: string;
    importMap?: {
      [packageName: string]: {
        [exportName: string]: {
          canonicalImport?: [string, string];
        };
      };
    };
  };
```

- **默认值：** `false`

若你在项目中使用了 `emotion`，并且想要类似 [@emotion/babel-plugin](https://emotion.sh/docs/@emotion/babel-plugin) 的能力，你可以开启 builtins.emotion 配置，启用该配置后，Rspack 会使用 `swc_emotion` 插件对 `emotion` 代码进行转译。

### 示例

你可以直接使用默认配置，直接将 `builtins.emotion` 设置为 `true` 即可。

```ts title="rspack.config.js"
module.exports = {
  context: __dirname,
  entry: {
    main: './src/index.js',
  },
  builtins: {
    emotion: true
  }
};
```

各字段与 [@emotion/babel-plugin](https://emotion.sh/docs/@emotion/babel-plugin) 保持一致，详细解释（下列内容部分取自 @emotion/babel-plugin 官方文档）：

#### autoLabel

- **类型：** `'never' | 'dev-only' | 'always'`
- **默认值：** `'dev-only'`

这个配置项用于：
- 生成 label 值，这样由 `css` 或者 `styled` 生成的样式中会包含原来的名字，方便调试。
- 注意样式名中非单词字符将被删除。比如 `iconStyles$1` 会变成 `iconStyles1`，因为 `$` 不是合法的 [CSS 类名选择器](https://stackoverflow.com/questions/448981/which-characters-are-valid-in-css-class-names-selectors#449000)。

不同的配置项会产生不同的产物代码：
- `'dev-only'`：只在 Rspack 的 development 模式下开启，在 production 模式下关闭以减小存储占用。
- `'always'`：无论什么模式下都开启该特效。
- `'never'`：无论什么模式下都禁用该特性。

#### labelFormat

- **类型：** `string`
- **默认值：** `"[local]"`

此选项仅在 `'autoLabel'` 设置为 `'dev-only'` 或 `'always'` 时有效。允许你自定义添加的 `label` 的结构。通过字符串定义，其中可变部分用方括号 `'[]'` 括起来。例如对于标签: `'my-classname——[local]'`，其中 `'[local]'` 将被替换为样式变量的名称。

允许的值:
- `'[local]'` - CSS 或样式表达式所在的文件名称
- `'[filename]'` - CSS 或样式表达式所在的文件名称(不带扩展名)。
- `'[dirname]'` - 包含 CSS 或样式表达式所在文件的目录名。

该配置只会影响表达式中的 `label` ，这意味着 CSS 前缀和 hash 会自动被添加。

#### sourceMap

- **类型：** `boolean`

该配置决定是否注入 source maps。production 模式下默认关闭，development 模式下默认开启。

#### importMap

- **类型：**

```ts
export type ImportMap = undefined | {
  [packageName: string]: {
    [exportName: string]: {
      canonicalImport?: [string, string];
    };
  };
};
```

- **默认值：** `undefined`

此选项允许你告诉 Rspack 它应该查看哪些 import 语句，确定应该转换什么，因此如果你重导出 emotion 的方法，仍然可以转换。
