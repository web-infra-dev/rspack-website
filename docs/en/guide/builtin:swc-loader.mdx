import { ApiMeta, Stability } from '../../../components/ApiMeta';

# builtin:swc-loader

<ApiMeta addedVersion="0.3.0" stability={Stability.Experimental} />

`builtin:swc-loader` is the Rust version of [`swc-loader`](https://github.com/swc-project/pkgs/tree/main/packages/swc-loader), aiming to deliver better performance. The Loader's [configuration](https://swc.rs/docs/configuration/compilation) is aligned with the JS version of `swc-loader` (SWC plugins will be provided in future releases and are currently not supported).

If you need to use `builtin:swc-loader` in your project, configure it as follows:

To transpile `ts` files:

```js
module.exports = {
  module: {
    rules: [
      {
        test: /\.ts$/,
        exclude: [/node_modules/],
        loader: 'builtin:swc-loader',
        options: {
          sourceMap: true,
          jsc: {
            parser: {
              syntax: 'typescript',
            },
          },
        },
        type: 'javascript/auto',
      },
    ],
  },
};
```

Or to transpile `jsx` files:

```js
module.exports = {
  module: {
    rules: [
      {
        test: /\.jsx$/,
        use: {
          loader: 'builtin:swc-loader',
          options: {
            sourceMap: true,
            jsc: {
              parser: {
                syntax: 'ecmascript',
                jsx: true,
              },
              transform: {
                react: {
                  pragma: 'React.createElement',
                  pragmaFrag: 'React.Fragment',
                  throwIfNamespace: true,
                  development: false,
                  useBuiltins: false,
                },
              },
            },
          },
        },
        type: 'javascript/auto',
      },
    ],
  },
};
```

Additionally, you can directly refer to [`example-builtin-swc-loader`](https://github.com/web-infra-dev/rspack/tree/main/examples/builtin-swc-loader) for more usage guidelines.

## options

See [SWC configuration](https://swc.rs/docs/configuration/swcrc).

### options.rspackExperiments

<ApiMeta stability={Stability.Experimental} addedVersion="0.3.3" />

These fields served as the alternative to the current builtin transform options, aiming to support transforming with respect to the certain module.

For react support, take [`options.jsc.transform.react`](https://swc.rs/docs/configuration/compilation#jsctransformreact) as a reference.

- **Type:**

```ts
export type RspackExperiments = {
  import?: PluginImportOptions;
  emotion?: EmotionOptions;
  relay?: RelayOptions;
  styledComponents?: StyledComponentsOptions;
};
```

- **Default:** `{}`

Some fields can be found in the [builtins](/config/builtins) section:

<ApiMeta stability={Stability.Experimental} addedVersion="0.3.3" />

- [import](/config/builtins#builtinspluginimport)
- [relay](/config/builtins#builtinsrelay)

And some new features will only provided by `builtin:swc-loader`.

### options.rspackExperiments.emotion

<ApiMeta stability={Stability.Experimental} addedVersion="0.3.7" />

Using optimization for emotion in compile-time.

- **Type:**

```ts
type EmotionOptions =
  | boolean
  | {
      sourceMap?: boolean;
      autoLabel?: 'never' | 'dev-only' | 'always';
      labelFormat?: string;
      importMap?: {
        [packageName: string]: {
          [exportName: string]: {
            canonicalImport?: [string, string];
          };
        };
      };
    };
```

- **Default:** `false`

If you are using `emotion` in your project, and want functionality which is similar to [@emotion/babel-plugin](https://emotion.sh/docs/@emotion/babel-plugin), you can enable `rspackExperiments.emotion` option, Rspack will use `swc_emotion` plugin to transpile your `emotion` code.

You can enable default options by specify `rspackExperiments.emotion: true`.

```ts title="rspack.config.js"
module.exports = {
  module: {
    rules: [
      {
        use: 'builtin:swc-loader',
        options: {
          ...
          rspackExperiments: {
            emotion: true
          }
        }
      }
    ]
  }
};
```

Each field name is the same with [@emotion/babel-plugin](https://emotion.sh/docs/@emotion/babel-plugin), more detailed explanation (content below is from the official document of [@emotion/babel-plugin](https://emotion.sh/docs/@emotion/babel-plugin)):

#### autoLabel

- **Type:** `'never' | 'dev-only' | 'always'`
- **Default:** `'dev-only'`

This option is used for:

- Automatically adds the label property to styles so that class names generated by css or styled include the name of the variable the result is assigned to.
- Please note that non word characters in the variable will be removed (Eg. `iconStyles$1` will become `iconStyles1`) because `$` is not valid[CSS ClassName Selector](https://stackoverflow.com/questions/448981/which-characters-are-valid-in-css-class-names-selectors#449000).

Each possible value for this option produces different output code:

- `'dev-only'` - we optimize the production code, so there are no labels added there, but at the same time we keep labels for development environments,
- `'always'` - we always add labels when possible,
- `'never'` - we disable this entirely and no labels are added.

#### labelFormat

- **Type:** `string`
- **Default:** `"[local]"`

This option only works when `'autoLabel'` is set to `'dev-only'` or `'always'`. It allows you to define the format of the resulting `label`. The format is defined via string where variable parts are enclosed in square brackets `[]`. For example labelFormat: `"my-classname--[local]"`, where `'[local]'` will be replaced with the name of the variable the result is assigned to.

Allowed values:

- `'[local]'` - the name of the variable the result of the css or styled expression is assigned to.
- `'[filename]'` - name of the file (without extension) where css or styled expression is located.
- `'[dirname]'` - name of the directory containing the file where css or styled expression is located.

This format only affects the label property of the expression, meaning that the css prefix and hash will be prepended automatically.

#### sourceMap

- **Type:** `boolean`

Whether to inject source maps. By default, this will be disabled in production mode, and enabled in development mode.

#### importMap

- **Type:**

```ts
export type ImportMap =
  | undefined
  | {
      [packageName: string]: {
        [exportName: string]: {
          canonicalImport?: [string, string];
        };
      };
    };
```

- **Default:** `undefined`

This option allows you to tell Rspack what imports it should look at to determine what it should transform so if you re-export Emotion's exports, you can still use the Babel transforms

### options.rspackExperiments.styledComponents

<ApiMeta stability={Stability.Experimental} addedVersion="0.3.7" />

- **Type:**

```ts
type StyledComponentsOptions = {
  displayName?: boolean;
  ssr?: boolean;
  fileName?: boolean;
  meaninglessFileNames?: string[];
  namespace?: string;
  topLevelImportPaths?: string[];
  transpileTemplateLiterals?: boolean;
  minify?: boolean;
  pure?: boolean;
  cssProps?: boolean;
};
```

- **Default:** `{}`

Configure the compile-time support for [styled-components](https://github.com/styled-components/styled-components). SWC's support for styled-components is essentially aligned with the official Babel plugin, so you can visit https://styled-components.com/docs/tooling#babel-plugin for more information.

Usually, you need to enable the JSX support of `builtin:swc-loader` to handle React components. The configuration may look like this:

```js
/** @type {import('@rspack/core').Configuration}*/
module.exports = {
  module: {
    rules: [
      {
        test: /\.jsx?$/,
        loader: 'builtin:swc-loader',
        options: {
          jsc: {
            parser: {
              syntax: 'ecmascript',
              jsx: true,
            },
          },
          rspackExperiments: {
            styledComponents: {
              displayName: true,
              ssr: true,
              fileName: true,
              meaninglessFileNames: ['index', 'styles'],
              namespace: 'rspack-test',
              topLevelImportPaths: [
                '@xstyled/styled-components',
                '@xstyled/styled-components/*',
              ],
              transpileTemplateLiterals: true,
              minify: true,
              pure: true,
              cssProps: true,
            },
          },
        },
      },
    ],
  },
};
```
