# Builtins

Used to set the built-in functions provided by Rspack.

- **Type:** `Record<string, any>`
- **Default:** `{}`

:::warning Stability Warning

The built-in functionality provided by _builtins_ may change in the future or be replaced with a better solution, so please note the changes to the builtins when you upgrade and we will highlight them in the [Release Notes](https://github.com/modern-js-dev/rspack/releases).

:::

## builtins.emotion

Using optimization for emotion in compile-time.

- **Type:**

```ts
export type EmotionConfig =
  | boolean
  | {
      sourceMap?: boolean;
      autoLabel?: 'never' | 'dev-only' | 'always';
      labelFormat?: string;
      importMap?: {
        [packageName: string]: {
          [exportName: string]: {
            canonicalImport?: [string, string];
          };
        };
      };
    };
```

- **Default:** `false`

If you are using `emotion` in your project, and want functionality which is similar to [@emotion/babel-plugin](https://emotion.sh/docs/@emotion/babel-plugin), you can enable `builtins.emotion` option, Rspack will use `swc_emotion` plugin to transpile your `emotion` code.

### Example

You can enable default options by specify `builtins.emotion: true`.

```ts title="rspack.config.js"
module.exports = {
  context: __dirname,
  entry: {
    main: './src/index.js',
  },
  builtins: {
    emotion: true,
  },
};
```

Each field name is the same with [@emotion/babel-plugin](https://emotion.sh/docs/@emotion/babel-plugin), more detailed explanation (content below is from the official document of @emotion/babel-plugin):

#### autoLabel

- **Type:** `'never' | 'dev-only' | 'always'`
- **Default:** `'dev-only'`

This option is used for:

- Automatically adds the label property to styles so that class names generated by css or styled include the name of the variable the result is assigned to.
- Please note that non word characters in the variable will be removed (Eg. `iconStyles$1` will become `iconStyles1`) because `$` is not valid[CSS ClassName Selector](https://stackoverflow.com/questions/448981/which-characters-are-valid-in-css-class-names-selectors#449000).

Each possible value for this option produces different output code:

- `'dev-only'` - we optimize the production code, so there are no labels added there, but at the same time we keep labels for development environments,
- `'always'` - we always add labels when possible,
- `'never'` - we disable this entirely and no labels are added.

#### labelFormat

- **Type:** `string`
- **Default:** `"[local]"`

This option only works when `'autoLabel'` is set to `'dev-only'` or `'always'`. It allows you to define the format of the resulting `label`. The format is defined via string where variable parts are enclosed in square brackets `[]`. For example labelFormat: `"my-classname--[local]"`, where `'[local]'` will be replaced with the name of the variable the result is assigned to.

Allowed values:

- `'[local]'` - the name of the variable the result of the css or styled expression is assigned to.
- `'[filename]'` - name of the file (without extension) where css or styled expression is located.
- `'[dirname]'` - name of the directory containing the file where css or styled expression is located.

This format only affects the label property of the expression, meaning that the css prefix and hash will be prepended automatically.

#### sourceMap

- **Type:** `boolean`

Whether to inject source maps. By default, this will be disabled in production mode, and enabled in development mode.

#### importMap

- **Type:**

```ts
export type ImportMap =
  | undefined
  | {
      [packageName: string]: {
        [exportName: string]: {
          canonicalImport?: [string, string];
        };
      };
    };
```

- **Default:** `undefined`

This option allows you to tell Rspack what imports it should look at to determine what it should transform so if you re-export Emotion's exports, you can still use the Babel transforms

## builtins.presetEnv

This option allows your code to run on older versions of browsers by querying all the browsers that need to be supported through [browserslist](https://github.com/browserslist/browserslist#queries).
If the source code uses APIs that are not supported by these browsers, the same APIs can be provided to these browsers by globally injecting [core-js](https://github.com/zloirock/core-js).
If the source code uses syntax that is not supported by these browsers, the syntax will also be converted into syntax supported by the browsers.

- **Type:**

```ts
type PresetEnv =
  | undefined
  | {
      mode?: 'usage' | 'entry';
      targets?: string[];
      coreJs?: string;
    };
```

- **Default:** `undefined`

| Name      | Type                          | Default   | Description                                                                                                                                                                                                                                                                                                                         |
| --------- | ----------------------------- | --------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `targets` | `string[]\|undefined`         | undefined | Use [browserslist query](https://github.com/browserslist/browserslist#queries) to specify the ECMAScript version of the user code. Rspack will try to use [browserslist](https://github.com/browserslist/browserslist) config on [context](config/context) directory when value is `undefined`.                                     |
| `mode`    | `'entry'\|'usage'\|undefined` | undefined | This option determine the behavior of polyfill injection, `'entry'` means that inject all polyfill that matches your needs, according to [browserslist](https://github.com/browserslist/browserslist) query, `'usage'` means only injects polyfills that source code uses, set this to `undefined` will not inject polyfill at all. |
| `coreJs`  | `string`                      | undefined | This option specify the version of core-js                                                                                                                                                                                                                                                                                          |

## builtins.html

This configuration simplifies creation of HTML files to serve your rspack bundles.

- **Type:**

```ts
type BuiltinsHtml = Array<{
  title?: string;
  filename?: string;
  template?: string;
  templateParameters?: Record<string, string>;
  inject?: 'head' | 'body';
  publicPath?: string;
  scriptLoading?: 'blocking' | 'defer' | 'module';
  chunks?: string[];
  excludedChunks?: string[];
  sri?: 'sha256' | 'sha384' | 'sha512';
  minify?: boolean;
  favicon?: string;
  meta?: Record<string, string | Record<string, string>>;
}>;
```

- **Default:** `[]`

| Name                 | Type                                             | Default      | Description                                                                                                                                                                                                                       |
| -------------------- | ------------------------------------------------ | ------------ | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `title`              | `string\|undefined`                              | undefined    | The title to use for the generated HTML document.                                                                                                                                                                                 |
| `filename`           | `string`                                         | 'index.html' | The file to write the HTML to. Defaults to `index.html`. You can specify a subdirectory here too (eg: pages/index.html).                                                                                                          |
| `template`           | `string\|undefined`                              | undefined    | The template file path.                                                                                                                                                                                                           |
| `templateParameters` | `Record<string, string>`                         | \{\}         | Allows to overwrite the parameters used in the template.                                                                                                                                                                          |
| `inject`             | `'head'\|'body'\|undefined`                      | undefined    | The script and link tag inject position in `template`.                                                                                                                                                                            |
| `publicPath`         | `string`                                         | ''           | The publicPath used for script and link tags.                                                                                                                                                                                     |
| `scriptLoading`      | `'blocking'\|'defer'\|'module'`                  | 'defer'      | Modern browsers support non blocking javascript loading ('defer') to improve the page startup performance. Setting to 'module' adds attribute type="module". This also implies "defer", since modules are automatically deferred. |
| `chunks`             | `string[]\|undefined`                            | undefined    | Allows you to add only some chunks.                                                                                                                                                                                               |
| `excludedChunks`     | `string[]\|undefined`                            | undefined    | Allows you to skip some chunks.                                                                                                                                                                                                   |
| `sri`                | `'sha256'\|'sha384'\|'sha512'\|undefined`        | undefined    | The sri hash algorithm, disabled by default.                                                                                                                                                                                      |
| `minify`             | `boolean`                                        | false        | Controls whether to minify the output.                                                                                                                                                                                            |
| `favicon`            | `string\|undefined`                              | undefined    | Adds the given favicon path to the output HTML.                                                                                                                                                                                   |
| `meta`               | `Record<string, string\|Record<string, string>>` | \{\}         | Allows to inject meta-tags.                                                                                                                                                                                                       |

## builtins.minifyOptions

Set built-in minimizer options.

- **Type:**

```ts
type BuiltinsMinifyOptions = {
  passes?: number;
  dropConsole?: boolean;
  pureFuncs?: Array<string>;
};
```

| Name          | Type            | Default | Description                                                                                            |
| ------------- | --------------- | ------- | ------------------------------------------------------------------------------------------------------ |
| `passes`      | `number`        | 1       | The maximum number of times to run compress.                                                           |
| `dropConsole` | `boolean`       | false   | Pass true to discard calls to console.\* functions.                                                    |
| `pureFuncs`   | `Array<string>` | []      | You can pass an array of names and rspack will assume that those functions do not produce side effects |

## builtins.define

Replaces variables in your code with other values or expressions at compile time.

- **Type:** `Record<string, string | boolean | undefined>`
- **Default:** `{}`

### Example

```ts title="rspack.config.js"
module.exports = {
  builtins: {
    define: {
      'process.env.NODE_ENV': "'development'",
      API_PREFIX: '/api',
      TRUE: true,
      TRUE_STRING: 'true',
      UNDEFINED: undefined,
      UNDEFINED_STRING: 'undefined',
    },
  },
};
```

Input:

```ts
if (process.env.NODE_ENV === 'development') {
  console.log('run in development mode');
}

fetch('API_PREFIX/test');

console.log(TRUE === TRUE_STRING);
console.log(UNDEFINED === UNDEFINED_STRING);
```

Output:

```ts
if ('development' === 'development') {
  console.log('run in development mode');
}

fetch('/api/test');

console.log(true === true);
console.log(undefined === undefined);
```

## builtins.react

This configuration can control the code transformation about react.

- **Type:**

```ts
type BuiltinsReact = {
  runtime?: 'automatic' | 'classic';
  importSource?: string;
  pragma?: string;
  pragmaFrag?: string;
  throwIfNamespace?: boolean;
  development?: boolean;
  useBuiltins?: boolean;
  useSpread?: boolean;
  refresh?: boolean;
};
```

- **Default:** `{}`

| Name               | Type                     | Default               | Description                                                                                                                                      |
| ------------------ | ------------------------ | --------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------ |
| `runtime`          | `'automatic'\|'classic'` | 'automatic'           | `automatic` to use a JSX runtime module, `classic` to use React.createElement instead.                                                           |
| `importSource`     | `string`                 | 'react'               | When using `runtime=automatic`, determines the runtime library to import.                                                                        |
| `pragma`           | `string`                 | 'React.createElement' | When using `runtime=classic`, replaces the function used when compiling JSX expressions.                                                         |
| `pragmaFrag`       | `string`                 | 'React.Fragment'      | Replace the component used when compiling JSX fragments.                                                                                         |
| `throwIfNamespace` | `boolean`                | true                  | Toggles whether or not to throw an error if an XML namespaced tag name is used. For example: <f:image />.                                        |
| `development`      | `boolean`                | false                 | Toggles debug props `__self` and `__source` on elements generated from JSX, which are used by development tooling such as React Developer Tools. |
| `useBuiltins`      | `boolean`                | false                 | Use `Object.assign()` instead of `_extends`.                                                                                                     |
| `useSpread`        | `boolean`                | false                 | Use `Object.assign()` instead of `spreading props`.                                                                                              |
| `refresh`          | `boolean`                | false                 | Enable react-refresh related transform.                                                                                                          |

## builtins.decorator

This configuration can be used to control decorator transform behavior, `false` means to turn off transform.

- **Type:**

```ts
type BuiltinsDecorator =
  | boolean
  | {
      legacy?: boolean;
      emitMetadata?: boolean;
    };
```

- **Default:** `true`

| Name           | Type      | Default | Description                                                                                                   |
| -------------- | --------- | ------- | ------------------------------------------------------------------------------------------------------------- |
| `legacy`       | `boolean` | true    | Use the [legacy (stage 1)](https://github.com/tc39/proposal-decorators) class decorators syntax and behavior. |
| `emitMetadata` | `boolean` | true    | Whether to keep metadata information.                                                                         |

## builtins.css

This configuration can be used to control how rspack handles css.

- **Type:**

```ts
type BuiltinsCss = {
  modules?: BuiltinsCssModules;
};
```

### builtins.css.modules

css modules options.

- **Type:**

```ts
type BuiltinsCssModules = {
  localsConvention?:
    | 'asIs'
    | 'camelCase'
    | 'camelCaseOnly'
    | 'dashes'
    | 'dashesOnly';
  localIdentName?: string;
  exportsOnly?: boolean;
};
```

| Name               | Type                                                                   | Default                                                              | Description                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| ------------------ | ---------------------------------------------------------------------- | -------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `localsConvention` | `'asIs' \| 'camelCase' \| 'camelCaseOnly' \| 'dashes' \| 'dashesOnly'` | 'asIs'                                                               | `asIs` Class names will be exported as is.<br/> `camelCase` Class names will be camelized, the original class name will not to be removed from the locals.<br/> `camelCaseOnly` Class names will be camelized, the original class name will be removed from the locals.<br/> `dashes` Only dashes in class names will be camelized.<br/> `dashesOnly` Dashes in class names will be camelized, the original class name will be removed from the locals. |
| `localIdentName`   | `string`                                                               | production: '[hash]'<br/>development: '[path][name][ext]\_\_[local]" | The generated local ident name. Supported template strings: <br/>`hash` hash string.<br/>`hash:<length>` hash with hash settings.<br/>`path` the path of the resource relative to the **context** option.<br/>`name` the basename of the resource.<br/>`ext` extension with leading `.`.<br/>`local` original class.                                                                                                                                    |
| `exportsOnly`      | `boolean`                                                              | false                                                                | Only export js object, without css file. Useful in SSR.                                                                                                                                                                                                                                                                                                                                                                                                 |

{/* ## builtins.postcss */}

{/* ## builtins.treeShaking */}

## builtins.progress

This configuration can be used to control progress, `false` means to turn off progress.

- **Type:**

```ts
type BuiltinsProgress = boolean | { prefix?: string };
```

- **Default:** `false`

| Name     | Type     | Default  | Description                             |
| -------- | -------- | -------- | --------------------------------------- |
| `prefix` | `string` | 'Rspack' | The text displayed before the progress. |

{/* ## builtins.noEmitAssets */}

## builtins.devFriendlySplitChunks

Whether to enable the development-friendly split chunks algorithm.

- **Type:** `boolean`

- **Default:** `false`
